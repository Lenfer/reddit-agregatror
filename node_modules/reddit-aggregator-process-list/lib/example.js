'use strict';


const _ = require('lodash');
const ProcessList = require('reddit-aggregator-process-list');
let data = JSON.parse(require('fs').readFileSync('../stubs/reddit.json').toString());


// Создаем объект для преобразования данных
let plist = new ProcessList({
	fieldTransformConcat: function(value, fieldDesc, data) {
		return _.map(fieldDesc.fields, function(path) {
			return _.get(data, path);
		}).join('-');
	}
});


let x = plist.list(data.data.children)
	.groupBy('data.domain', {
		domain: 'data.domain',
		articles: {
			aggregate: 'count'
		},
		score: {
			path: 'data.score',
			aggregate: 'sum'
		}
	})
	.sortBy('articles', 'desc')
	.get();

console.log(x);


let y = plist.list(data.data.children)
	.transformBy({
		id: 'data.id',
		title: {
			path: 'data.title',
			transform: function(val) {
				return val.toUpperCase();
			}
		},
		created: {
			path: 'data.created_utc',
			transform: 'utc-time'
		},
		score: 'data.score',
		recUid: {
			transform: 'concat',
			fields: ['data.id', 'data.score']
		}
	})
	.sortBy('id', 'desc')
	.get();


console.log(JSON.stringify(y, '', '  '));

