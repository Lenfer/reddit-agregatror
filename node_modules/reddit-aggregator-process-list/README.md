# reddit-aggregator-process-list

```javascript
let ProcessList = require('reddit-aggregator-process-list');
let data = JSON.parse(require('fs').readFileSync('../stubs/reddit.json').toString());
let plist = new ProcessList(data.data.children, {
});
```


## ProcessList.sortBy(path, sortingOrder) - Сортировка исходного списка

```javascript
plist.sortBy('score');
plist.sortBy('score', 'desc').extractBy(['score']);
```


## ProcessList.transformBy(shema) - преобразование списка по схеме

```javascript
let result = plist.extractBy({
    id: 'data.id',
    title: {
        path: 'data.title',
        transform: function(val) {
            return val.toUpperCase();
        }
    },
    created: {
        name: 'data.created_utc',
        transform: 'utc-time'
    },
    score: 'data.score'
});
```

Оптсание схемы представляет из себя объект, ключи указывают на новые пути полей в объектеб а значения описывают
пути к источникам и методы преобразования.
1. Строки - названия полей в записи (date, path.to.needed)
2. Объекты состоят и набора полей описывающих:
    - имя поле (name) - название или путь
    - тренсформацию поля (transform) - может принимать значение функции для исполнения или строку, из которой будет построено имя функции внутри класса 'transformField' +  Имя (декларативный подход)

**Пример по доопределению методов преобразования полей**
```javascript
let plist = new ProcessList(data.data.children, {
    fieldTransformConcat: function(value, fieldDesc, data) {
        return _.map(fieldDesc.fields, function(path) {
            return _.get(data, path);
        }).join('-');
    }
});

let result = plist.extractBy({
    concatedField: {
        transform: 'concat',
        fields: ['id', 'score']
    }
});
```


## ProcessList.groupBy(groupFieldPath, shema) - Групировка записей и агрегация полей

```javascript
plist.list(data.data.children)
    .groupBy('data.domain', {
        domain: 'data.domain',
        articles: {
            aggregate: 'count'
        },
        score: {
            path: 'data.score',
            aggregate: 'sum'
        }
    })
    .sortBy('articles', 'desc')
    .get();
```

см. пример lib/example.js